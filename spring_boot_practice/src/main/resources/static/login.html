<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<body>
    <h1>로그인</h1>
    <form id="loginForm">
        <label for="username">사용자 이름:</label><br>
        <input type="text" id="username" name="username"><br>
        <label for="password">비밀번호:</label><br>
        <input type="password" id="password" name="password"><br><br>
        <button type="submit">로그인</button>
    </form>
    <div id="loginResponse"></div>
    <br>
    <a href="/register.html">회원가입 페이지로 이동</a>

    <hr>

    <h2>인증된 API 테스트 (주소창에서 직접 호출)</h2>
    <p>로그인 성공 후, 아래 예시처럼 브라우저 주소창에 직접 API 주소를 입력하여 호출해 보세요.</p>
    <p><strong>예시:</strong> <a href="/user/자신이_가입한_아이디" target="_blank">/user/자신이_가입한_아이디</a></p>
    <p>만약 'admin' 사용자로 로그인했다면, <a href="/user/all" target="_blank">/user/all</a> 도 호출 가능합니다.</p>

    <script>
        // 로그인 폼 처리
        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const responseDiv = document.getElementById('loginResponse');

            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const resultText = await response.text();

                if (response.ok) {
                    // 성공 시, 서버가 쿠키를 자동으로 설정해줍니다.
                    responseDiv.innerHTML = `<p><strong>로그인 성공!</strong></p><p>서버 응답: ${resultText}</p><p>이제 브라우저가 인증 쿠키를 자동으로 관리합니다. 위 링크를 클릭하거나 주소창에 직접 API를 호출해 보세요.</p>`;
                } else {
                    // 실패 시, 오류 메시지를 JSON으로 파싱 시도
                    try {
                        const errorResult = JSON.parse(resultText);
                        responseDiv.innerHTML = `<p><strong>로그인 오류:</strong></p><pre>${JSON.stringify(errorResult, null, 2)}</pre>`;
                    } catch (e) {
                        responseDiv.innerHTML = `<p><strong>로그인 오류:</strong></p><pre>${resultText}</pre>`;
                    }
                }
            } catch (error) {
                responseDiv.innerHTML = `<p><strong>네트워크 오류:</strong></p><pre>${error.message}</pre>`;
            }
        });
    </script>
</body>
</html>
